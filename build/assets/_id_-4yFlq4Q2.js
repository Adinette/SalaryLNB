import{_ as B}from"./UserForm.vue_vue_type_script_setup_true_lang-Cx2Wminf.js";import{_ as $}from"./BaseBlock.vue_vue_type_script_setup_true_lang-BhfpUZf_.js";import{f as _}from"./chunk-TVFJBHBT-BUrEn1b-.js";import{u as C,a as N}from"./use_user_actions-BzxLXgV7.js";import{d as k,a3 as j,N as R,c as T,k as c,m as z,f as I,o as y,w as p,b as n,h as d,i as v,n as P,bU as W,a4 as g,a0 as q,a2 as b,q as D,a as H,g as U,F as G}from"./index-djH96c7W.js";import{A as h,U as J}from"./api_route-BfCuro4K.js";import{_ as K}from"./BasePageHeading.vue_vue_type_script_setup_true_lang-D3hGS5P4.js";import{b as E}from"./route-block-B_A1xBdJ.js";import"./index-C-RzZ9jy.js";import"./VRow-DOGGYPzI.js";import"./createSimpleFunctional-CGAgNBGN.js";import"./VInput-CtsUFMyD.js";import"./index-BQUvywfj.js";import"./VTextField-BiIaNMKF.js";const O={class:"pb-8"},w="Modifier l'utilisateur",Q="Enregistrer",X="ri-save-line",Y=k({__name:"UserEditView",setup(V){const i=j("userEditView"),t=R(),u=T(()=>!!t.params.id);console.log("isEditMode",u.value,t.params);const a=c(null),r=c({first_name:"",last_name:"",email:"",phone:""}),l=c({first_name:[],last_name:[],email:[],phone:[]}),m=c(null),{processing:f}=C(),x=s=>{l.value.first_name=s.data.first_name||[],l.value.last_name=s.data.last_name||[],l.value.email=s.data.email||[],l.value.phone=s.data.phone||[]},M=async()=>{a.value||(a.value=await N());const s=t.params.id;await a.value.getUsers();const e=await a.value.findUser(s);if(e instanceof h){m.value={type:"danger",id:_.string.uuid(),title:"Erreur",message:e.message};return}const o=new W(e.interface);r.value={first_name:o.first_name,last_name:o.last_name,email:o.email,phone:o.phone?g.formatPhoneWithSpaces(o.phone):""}},A=async s=>{if(!a.value)return i.error("Le store utilisateur n'est pas initialisé."),!1;i.info("Mise à jour de l'utilisateur",s);const e=await a.value.updateUser(t.params.id,s);return e instanceof h?(e instanceof J?x(e):(b.error(e.message),i.error("Erreur lors de la mise à jour de l'utilisateur",e)),m.value={type:"danger",id:_.string.uuid(),title:"Erreur",message:e.message},!1):(i.info("Utilisateur mis à jour avec succès",e),b.success("Utilisateur modifié avec succès !"),!0)},F=()=>{l.value={first_name:[],last_name:[],email:[],phone:[]},m.value=null},L=async()=>{if(F(),!a.value){i.error("Le store utilisateur n'est pas initialisé.");return}i.info("Soumission du formulaire d'utilisateur",r.value),await A({...r.value,phone:g.removeWhitespace(r.value.phone)})&&q.push("/users")};return z(async()=>{await M()}),(s,e)=>{const o=B;return y(),I($,{title:w,class:P(["block-mode-loading-oneui",{"block-mode-loading":v(f)}])},{default:p(()=>[n("div",O,[d(o,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=S=>r.value=S),loading:v(f),errors:l.value,alert:m.value,"action-description":w,"action-text":Q,"action-icon":X,"is-edit-mode":u.value,onSubmit:L},null,8,["modelValue","loading","errors","alert","is-edit-mode"])])]),_:1},8,["class"])}}}),Z={"aria-label":"breadcrumb"},ee={class:"breadcrumb breadcrumb-alt"},te={class:"breadcrumb-item","aria-current":"page"},se={class:"content"},ae="Formulaire des utilisateurs",re="Modifier un utilisateur.",ie=k({__name:"[id]",setup(V){return(i,t)=>{const u=D("RouterLink"),a=K,r=Y;return y(),H(G,null,[d(a,{title:ae,subtitle:re},{extra:p(()=>[n("nav",Z,[n("ol",ee,[t[1]||(t[1]=n("li",{class:"breadcrumb-item","aria-current":"page"},"Utilisateurs",-1)),n("li",te,[d(u,{to:"/users"},{default:p(()=>[...t[0]||(t[0]=[U(" Liste des utilisateurs",-1)])]),_:1})]),t[2]||(t[2]=U()),t[3]||(t[3]=n("li",{class:"breadcrumb-item active","aria-current":"page"},"Formulaire des utilisateurs",-1))])])]),_:1}),n("div",se,[d(r)])],64)}}});typeof E=="function"&&E(ie);export{ie as default};
