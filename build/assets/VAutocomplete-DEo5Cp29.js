import{u as Le,a as Re,b as Oe,m as Ee}from"./VSelect-D7Z0k7d_.js";import{a as ie,m as Te}from"./VTextField-BiIaNMKF.js";import{a7 as me,aE as K,c as _,i as z,aR as Be,b as I,n as G,F as Q,aS as le,aT as Ne,a6 as $e,aU as Ue,k as H,aV as je,a8 as q,R as W,$ as oe,aW as ze,aa as He,h as k,G as se,aX as We,ac as P,aY as Ge,O as Qe,ap as Xe,g as Ye,ad as Ze,ae as Je,aZ as ce,a_ as qe,a$ as fe}from"./index-djH96c7W.js";import{b as el}from"./VInput-CtsUFMyD.js";import{u as ll,V as tl,a as al,b as ve,d as ul,e as nl}from"./VMenu-C6zDN-ie.js";import{a as rl,V as de}from"./VChip-CI_Lgiys.js";import{V as il}from"./VAvatar-DCqiVCq3.js";const ol=(e,i,t)=>{if(e==null||i==null)return-1;if(!i.length)return 0;e=e.toString().toLocaleLowerCase(),i=i.toString().toLocaleLowerCase();const m=[];let o=e.indexOf(i);for(;~o;)m.push([o,o+i.length]),o=e.indexOf(i,o+i.length);return m.length?m:-1};function ee(e,i){if(!(e==null||typeof e=="boolean"||e===-1))return typeof e=="number"?[[e,e+i.length]]:Array.isArray(e[0])?e:[e]}const sl=me({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function cl(e,i,t){var C;const m=[],o=(t==null?void 0:t.default)??ol,y=t!=null&&t.filterKeys?le(t.filterKeys):!1,v=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return m;let V=null;e:for(let S=0;S<e.length;S++){const[a,w=a]=le(e[S]),x={},A={};let b=-1;if((i||v>0)&&!(t!=null&&t.noFilter)){let T=!1;if(typeof a=="object"){if(a.type==="divider"||a.type==="subheader"){(V==null?void 0:V.type)==="divider"&&a.type==="subheader"&&m.push(V),V={index:S,matches:{},type:a.type};continue}const r=y||Object.keys(w);T=r.length===v;for(const B of r){const R=Ne(w,B),O=(C=t==null?void 0:t.customKeyFilter)==null?void 0:C[B];if(b=O?O(R,i,a):o(R,i,a),b!==-1&&b!==!1)O?x[B]=ee(b,i):A[B]=ee(b,i);else if((t==null?void 0:t.filterMode)==="every")continue e}}else b=o(a,i,a),b!==-1&&b!==!1&&(A.title=ee(b,i));const L=Object.keys(A).length,c=Object.keys(x).length;if(!L&&!c||(t==null?void 0:t.filterMode)==="union"&&c!==v&&!L||(t==null?void 0:t.filterMode)==="intersection"&&(c!==v||!L&&v>0&&!T))continue}V&&(m.push(V),V=null),m.push({index:S,matches:{...A,...x}})}return m}function fl(e,i,t,m){const o=K([]),y=K(new Map),v=_(()=>z(i));Be(()=>{const C=typeof t=="function"?t():z(t),S=typeof C!="string"&&typeof C!="number"?"":String(C),a=cl(v.value,S,{customKeyFilter:{...e.customKeyFilter,...z(m==null?void 0:m.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),w=z(i),x=[],A=new Map;a.forEach(b=>{let{index:T,matches:L}=b;const c=w[T];x.push(c),A.set(c.value,L)}),o.value=x,y.value=A});function V(C){return y.value.get(C.value)}return{filteredItems:o,filteredMatches:y,getMatches:V}}function vl(e,i,t){return t==null||!t.length?i:t.map((m,o)=>{const y=o===0?0:t[o-1][1],v=[I("span",{class:G(`${e}__unmask`)},[i.slice(y,m[0])]),I("span",{class:G(`${e}__mask`)},[i.slice(m[0],m[1])])];return o===t.length-1&&v.push(I("span",{class:G(`${e}__unmask`)},[i.slice(m[1])])),I(Q,null,[v])})}const dl=me({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...sl({filterKeys:["title"]}),...Ee(),...Je(Te({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"])},"VAutocomplete"),bl=$e()({name:"VAutocomplete",props:dl(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,i){let{slots:t}=i;const{t:m}=Ue(),o=H(),y=K(!1),v=K(!0),V=K(!1),C=H(),S=H(),a=K(-1),w=K(null),{items:x,transformIn:A,transformOut:b}=ll(e),{textColorClasses:T,textColorStyles:L}=je(()=>{var l;return(l=o.value)==null?void 0:l.color}),c=q(e,"search",""),r=q(e,"modelValue",[],l=>A(l===null?[null]:le(l)),l=>{const u=b(l);return e.multiple?u:u[0]??null}),B=_(()=>typeof e.counterValue=="function"?e.counterValue(r.value):typeof e.counterValue=="number"?e.counterValue:r.value.length),R=el(e),{filteredItems:O,getMatches:he}=fl(e,x,()=>w.value??(v.value?"":c.value)),D=_(()=>e.hideSelected&&w.value===null?O.value.filter(l=>!r.value.some(u=>u.value===l.value)):O.value),$=_(()=>!!(e.chips||t.chip)),N=_(()=>$.value||!!t.selection),ge=_(()=>r.value.map(l=>l.props.value)),X=_(()=>{var u;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&c.value===((u=D.value[0])==null?void 0:u.title))&&D.value.length>0&&!v.value&&!V.value}),U=_(()=>e.hideNoData&&!D.value.length||R.isReadonly.value||R.isDisabled.value),Y=q(e,"menu"),p=_({get:()=>Y.value,set:l=>{var u;Y.value&&!l&&((u=C.value)!=null&&u.Î¨openChildren.size)||l&&U.value||(Y.value=l)}}),{menuId:ye,ariaExpanded:pe,ariaControls:Ve,ariaLabel:te}=Le(e,p),Z=H(),ke=Re(Z,o);function be(l){e.openOnClear&&(p.value=!0),c.value=""}function Fe(){U.value||(p.value=!0)}function Ce(l){U.value||(y.value&&(l.preventDefault(),l.stopPropagation()),p.value=!p.value)}function Se(l){var u;(ce(l)||l.key==="Backspace")&&((u=o.value)==null||u.focus())}function we(l){var n,h,F,M,s;if(R.isReadonly.value)return;const u=(n=o.value)==null?void 0:n.selectionStart,f=r.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(p.value=!0),["Escape"].includes(l.key)&&(p.value=!1),X.value&&["Enter","Tab"].includes(l.key)&&!r.value.some(d=>{let{value:g}=d;return g===D.value[0].value})&&E(D.value[0]),l.key==="ArrowDown"&&X.value&&((h=Z.value)==null||h.focus("next")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&N.value&&r.value.length>0&&!c.value)return E(r.value[0],!1);if(~a.value){l.preventDefault();const d=a.value;E(r.value[a.value],!1),a.value=d>=f-1?f-2:d}else l.key==="Backspace"&&!c.value&&(a.value=f-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(a.value<0&&u&&u>0)return;const d=a.value>-1?a.value-1:f-1;if(r.value[d])a.value=d;else{const g=((F=c.value)==null?void 0:F.length)??null;a.value=-1,(M=o.value)==null||M.setSelectionRange(g,g)}}else if(l.key==="ArrowRight"){if(a.value<0)return;const d=a.value+1;r.value[d]?a.value=d:(a.value=-1,(s=o.value)==null||s.setSelectionRange(0,0))}else~a.value&&ce(l)&&(a.value=-1)}function xe(l){if(fe(o.value,":autofill")||fe(o.value,":-webkit-autofill")){const u=x.value.find(f=>f.title===l.target.value);u&&E(u)}}function Me(){var l;e.eager&&((l=S.value)==null||l.calculateVisibleItems())}function Ie(){var l;y.value&&(v.value=!0,(l=o.value)==null||l.focus()),w.value=null}function Ae(l){y.value=!0,setTimeout(()=>{V.value=!0})}function De(l){V.value=!1}function Pe(l){(l==null||l===""&&!e.multiple&&!N.value)&&(r.value=[])}const J=K(!1);function E(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const f=r.value.findIndex(h=>(e.valueComparator||qe)(h.value,l.value)),n=u??!~f;if(~f){const h=n?[...r.value,l]:[...r.value];h.splice(f,1),r.value=h}else n&&(r.value=[...r.value,l]);e.clearOnSelect&&(c.value="")}else{const f=u!==!1;r.value=f?[l]:[],w.value=v.value?"":c.value??"",c.value=f&&!N.value?l.title:"",oe(()=>{p.value=!1,v.value=!0})}}return W(y,(l,u)=>{var f;l!==u&&(l?(J.value=!0,c.value=e.multiple||N.value?"":String(((f=r.value.at(-1))==null?void 0:f.props.title)??""),v.value=!0,oe(()=>J.value=!1)):(!e.multiple&&c.value==null&&(r.value=[]),p.value=!1,!v.value&&c.value&&(w.value=c.value),c.value="",a.value=-1))}),W(c,l=>{!y.value||J.value||(l&&(p.value=!0),v.value=!l)}),W(p,l=>{if(!e.hideSelected&&l&&r.value.length&&v.value){const u=D.value.findIndex(f=>r.value.some(n=>f.value===n.value));ze&&window.requestAnimationFrame(()=>{var f;u>=0&&((f=S.value)==null||f.scrollToIndex(u))})}l&&(w.value=null)}),W(x,(l,u)=>{p.value||y.value&&!u.length&&l.length&&(p.value=!0)}),He(()=>{const l=!!(!e.hideNoData||D.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),u=r.value.length>0,f=ie.filterProps(e);return k(ie,P({ref:o},f,{modelValue:c.value,"onUpdate:modelValue":[n=>c.value=n,Pe],focused:y.value,"onUpdate:focused":n=>y.value=n,validationValue:r.externalValue,counterValue:B.value,dirty:u,onChange:xe,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":p.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!N.value,"v-autocomplete--selecting-index":a.value>-1},e.class],style:e.style,readonly:R.isReadonly.value,placeholder:u?void 0:e.placeholder,"onClick:clear":be,"onMousedown:control":Fe,onKeydown:we,"aria-expanded":pe.value,"aria-controls":Ve.value}),{...t,default:()=>I(Q,null,[k(tl,P({id:ye.value,ref:C,modelValue:p.value,"onUpdate:modelValue":n=>p.value=n,activator:"parent",contentClass:"v-autocomplete__content",disabled:U.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:Me,onAfterLeave:Ie},e.menuProps),{default:()=>[l&&k(al,P({ref:Z,filterable:!0,selected:ge.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),onKeydown:Se,onFocusin:Ae,onFocusout:De,tabindex:"-1",selectable:!0,"aria-live":"polite",color:e.itemColor??e.color},ke,e.listProps),{default:()=>{var n,h,F;return[(n=t["prepend-item"])==null?void 0:n.call(t),!D.value.length&&!e.hideNoData&&(((h=t["no-data"])==null?void 0:h.call(t))??k(ve,{key:"no-data",title:m(e.noDataText)},null)),k(Oe,{ref:S,renderless:!0,items:D.value,itemKey:"value"},{default:M=>{var ue,ne,re;let{item:s,index:d,itemRef:g}=M;const ae=P(s.props,{ref:g,key:s.value,active:X.value&&d===0?!0:void 0,onClick:()=>E(s,null)});return s.type==="divider"?((ue=t.divider)==null?void 0:ue.call(t,{props:s.raw,index:d}))??k(ul,P(s.props,{key:`divider-${d}`}),null):s.type==="subheader"?((ne=t.subheader)==null?void 0:ne.call(t,{props:s.raw,index:d}))??k(nl,P(s.props,{key:`subheader-${d}`}),null):((re=t.item)==null?void 0:re.call(t,{item:s,index:d,props:ae}))??k(ve,P(ae,{role:"option"}),{prepend:j=>{let{isSelected:_e}=j;return I(Q,null,[e.multiple&&!e.hideSelected?k(rl,{key:s.value,modelValue:_e,ripple:!1,tabindex:"-1",onClick:Ke=>Ke.preventDefault()},null):void 0,s.props.prependAvatar&&k(il,{image:s.props.prependAvatar},null),s.props.prependIcon&&k(se,{icon:s.props.prependIcon},null)])},title:()=>{var j;return v.value?s.title:vl("v-autocomplete",s.title,(j=he(s))==null?void 0:j.title)}})}}),(F=t["append-item"])==null?void 0:F.call(t)]}})]}),r.value.map((n,h)=>{function F(g){g.stopPropagation(),g.preventDefault(),E(n,!1)}const M=P(de.filterProps(n.props),{"onClick:close":F,onKeydown(g){g.key!=="Enter"&&g.key!==" "||(g.preventDefault(),g.stopPropagation(),F(g))},onMousedown(g){g.preventDefault(),g.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),s=$.value?!!t.chip:!!t.selection,d=s?Ge($.value?t.chip({item:n,index:h,props:M}):t.selection({item:n,index:h})):void 0;if(!(s&&!d))return I("div",{key:n.value,class:G(["v-autocomplete__selection",h===a.value&&["v-autocomplete__selection--selected",T.value]]),style:Qe(h===a.value?L.value:{})},[$.value?t.chip?k(Xe,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:n.title}}},{default:()=>[d]}):k(de,P({key:"chip",closable:e.closableChips,size:"small",text:n.title,disabled:n.props.disabled},M),null):d??I("span",{class:"v-autocomplete__selection-text"},[n.title,e.multiple&&h<r.value.length-1&&I("span",{class:"v-autocomplete__selection-comma"},[Ye(",")])])])})]),"append-inner":function(){var M,s;for(var n=arguments.length,h=new Array(n),F=0;F<n;F++)h[F]=arguments[F];return I(Q,null,[(M=t["append-inner"])==null?void 0:M.call(t,...h),e.menuIcon?k(se,{class:"v-autocomplete__menu-icon",color:(s=o.value)==null?void 0:s.fieldIconColor,icon:e.menuIcon,onMousedown:Ce,onClick:We,"aria-label":te.value,title:te.value,tabindex:"-1"},null):void 0])}})}),Ze({isFocused:y,isPristine:v,menu:p,search:c,filteredItems:O,select:E},o)}});export{bl as V};
