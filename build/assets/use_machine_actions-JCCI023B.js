var q=Object.defineProperty;var x=(t,s,e)=>s in t?q(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var d=(t,s,e)=>x(t,typeof s!="symbol"?s+"":s,e);import{ag as U,ah as I,ai as b,aj as g,ak as T,k as _,c as L,m as C,a4 as D,a3 as O,a2 as h}from"./index-djH96c7W.js";import{a as z,b as p,A as c,N as M}from"./api_route-BfCuro4K.js";import{m as j}from"./machines-DgIDqdM-.js";class o extends U{constructor(e){super(e);d(this,"code");d(this,"emplacement");d(this,"is_active");d(this,"operator_id");this.code=e.code,this.emplacement=e.emplacement,this.is_active=e.is_active,this.operator_id=e.operator_id}get interface(){return{...super.interface,code:this.code,emplacement:this.emplacement,is_active:this.is_active,operator_id:this.operator_id}}get json(){return JSON.stringify(this.interface)}get estAttribuee(){return!!this.operator_id}}const P={};function B(t,s){t.elements.push(s)}function G(t,{id:s}){return t.elements.find(e=>e.id===s)}function N(t,{id:s,data:e}){const n=t.elements.findIndex(a=>a.id===s);n!==-1&&(t.elements[n]={...t.elements[n],...e})}function F(t,{id:s}){t.elements=t.elements.filter(e=>e.id!==s)}class u extends z{get store(){return f()}async request(){const s=await this.store;s.setLoading(!0);const e=await super.request();return s.setLoading(!1),e}}d(u,"name","machines");class V extends u{constructor(s={}){super(`/${u.name}`,p.GET,s)}async request(){const s=await super.request();return s instanceof c?s:s.map(e=>new o(e))}async mock(){const s=await this.store;s.elements.length===0&&(s.elements=[...j]);let e=s.elements.map(n=>new o(n));if(this.data&&this.data.search){const n=this.data.search.toLowerCase();e=e.filter(a=>a.first_name.toLowerCase().includes(n)||a.last_name.toLowerCase().includes(n)||a.email.toLowerCase().includes(n)||a.phone&&a.phone.toLowerCase().includes(n))}return e}}async function H(t,{args:s}={}){const n=await new V(s).mock();return n instanceof c||(t.elements=n.map(a=>a.interface)),n}class J extends u{constructor({elementId:e}){super(`/${u.name}/${e}`,p.GET,{id:e});d(this,"elementId");this.elementId=e}async request(){const e=await super.request();return e instanceof c?e:new o(e)}async mock(){const n=(await this.store).find(this.elementId);return n?new o(n):new M({message:`Utilisateur avec l'ID ${this.elementId} non trouv√©`})}}async function K(t,{elementId:s}){const n=await new J({elementId:s}).mock();return n instanceof c,n}class Q extends u{constructor(e){super(`/${u.name}`,p.POST,e);d(this,"data");this.data=e}async request(){const e=await super.request();return e instanceof c?e:new o(e)}async mock(){const e=await this.store,n=new o({...this.data,id:"1",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});return e.add(n.interface),n}}async function W(t,{data:s}){const n=await new Q(s).mock();return n instanceof c,n}class X extends u{constructor(e,n){super(`/${u.name}/${e}`,p.PUT,n);d(this,"elementId");this.data=n,this.elementId=e}async request(){const e=await super.request();return e instanceof c?e:new o(e)}async mock(){const e=await this.store,n=e.find(this.elementId);if(!n)return new M({message:`Aucune machine trouv√© avec l'ID ${this.elementId}.`});const a=new o({...n,...this.data,updated_at:new Date().toISOString()});return e.update(this.elementId,a.interface),a}}async function Y(t,{elementId:s,data:e}){const a=await new X(s,e).mock();return a instanceof c,a}class Z extends u{constructor(e){super(`/${u.name}/${e}`,p.DELETE,{elementId:e});d(this,"elementId");this.elementId=e}async request(){const e=await super.request();return e instanceof c?e:new o(e)}async mock(){const e=await this.store,n=e.find(this.elementId);return n?(e.remove(this.elementId),new o(n)):new M({message:`Aucune machine trouv√©e avec l'ID ${this.elementId}.`})}}async function ee(t,{elementId:s}){const n=await new Z(s).mock();return n instanceof c,n}async function te(t,s={}){t.loading=!0,I.info(`[üçç][${t.$id}]: Executing setMachines()`),t.elements=s.users||[],t.loading=!1,I.success(`[üçç][${t.$id}]: setMachines() completed`)}class ne extends u{constructor({elementId:e}){super(`/${u.name}/${e}/publish`,p.PUT);d(this,"elementId");this.elementId=e}async request(){const e=await super.request();return e instanceof c?e:new o(e)}async mock(){const e=await this.store,n=e.find(this.elementId);if(!n)return new M({message:`Aucune machine trouv√©e avec l'ID ${this.elementId}.`});const a=new o({...n,is_active:!0,updated_at:new Date().toISOString()});return await e.update(this.elementId,a.interface),a}}async function se(t,{elementId:s,mock:e=!1}){const n=new ne({elementId:s}),a=e?await n.mock():await n.request();return a instanceof c,a}class ae extends u{constructor({elementId:e}){super(`/${u.name}/${e}/unpublish`,p.PUT);d(this,"elementId");this.elementId=e}async request(){const e=await super.request();return e instanceof c?e:new o(e)}async mock(){const e=await this.store,n=e.find(this.elementId);if(!n)return new M({message:`Aucune machine trouv√©e avec l'ID ${this.elementId}.`});const a=new o({...n,is_active:!1,updated_at:new Date().toISOString()});return await e.update(this.elementId,a.interface),a}}async function re(t,{elementId:s,mock:e=!1}){const n=new ae({elementId:s});console.log(n);const a=e?await n.mock():await n.request();return a instanceof c,a}const l={setMachines:te,...b(g.service),add:B,find:G,update:N,remove:F,getMachines:H,findMachine:K,createMachine:W,updateMachine:Y,updateMachineActivate:se,updateMachineDeactivate:re,deleteMachine:ee},ie=T(g.key,{state:()=>structuredClone(g.service.defaults),getters:P,actions:{add(t){return l.add(this,t)},find(t){return l.find(this,{id:t})},update(t,s){return l.update(this,{id:t,data:s})},remove(t){return l.remove(this,{id:t})},getMachines(t){return l.getMachines(this,{args:t})},findMachine(t){return l.findMachine(this,{elementId:t})},createMachine(t){return l.createMachine(this,{data:t})},updateMachine(t,s){return l.updateMachine(this,{elementId:t,data:s})},updateMachineActivate(t){return l.updateMachineActivate(this,{elementId:t,mock:!0})},updateMachineDeactivate(t){return l.updateMachineDeactivate(this,{elementId:t,mock:!0})},deleteMachine(t){return l.deleteMachine(this,{elementId:t})},initialize({reset:t=!1}={}){return l.initialize(this,{reset:t})},setLoading(t){return l.setLoading(this,t)},setMachines(t){return l.setMachines(this,t)}}});async function f(){const t=ie();return t.initialized||await t.initialize({reset:!1}),t}const v=O("use_machine_actions"),de=()=>{const t=_(null),s=_([]),e=L(()=>t.value?t.value.loading:!0),n=async()=>{t.value||(t.value=await f());const i=await t.value.getMachines();if(i instanceof c)return v.error("Error fetching machines:",{result:i}),h.error("Erreur lors de la r√©cup√©ration des utilisateurs"),[];s.value=[...i]},a=async i=>{t.value||(t.value=await f());const r=await t.value.findMachine(i);return r instanceof c?(v.error("Error finding machine:",r),h.error(`Erreur lors de la recherche de l'utilisateur avec l'ID ${i}`),null):(h.success(`Utilisateur avec l'ID ${i} trouv√© avec succ√®s.`),new o(r.interface))},k=async i=>{t.value||(t.value=await f());const r=await t.value.createMachine(i);return r instanceof c?(v.error("Error creating machine:",r),h.error(`Erreur lors de la cr√©ation de l'utilisateur: ${r.message}`),r):(h.success("Utilisateur cr√©√© avec succ√®s."),new o(r.interface))},R=async(i,r)=>{t.value||(t.value=await f());const m=await t.value.updateMachine(i,r);return m instanceof c?(v.error("Error updating machine:",m),h.error(`Erreur lors de la mise √† jour de l'utilisateur: ${m.message}`),m):(h.success("Utilisateur mis √† jour avec succ√®s."),new o(m.interface))},A=async(i,r,m)=>{const S=r?"de d√©sactiver":"de activer";D.showAlert({title:"√ätes-vous s√ªr ?",html:`Vous √™tes sur le point ${S} la machine <b class="font-mono">${m.code} d√©ployer √† ${m.emplacement}</b> .
        √ätes-vous s√ªr de vouloir continuer ?<br><br> Cette action est <b class="text-pink-950">irr√©versible</b>`,confirmButtonText:`Oui, ${r?"D√©sactiver":"Activer"}`,onConfirm:async()=>{var y,$;let w;if(r?w=await((y=t.value)==null?void 0:y.updateMachineDeactivate(i)):w=await(($=t.value)==null?void 0:$.updateMachineActivate(i)),w instanceof c)return v.error(`Error ${r?"la desactivation":"l'activation"} de la machine:`,w),h.error(`Erreur lors de  ${r?"la desactivation":"l'activation"} de la machine: ${w.message}`),w;h.success(`${r?"D√©sactivation":"Activation"} de la machine r√©ussie!`),await n()}})},E=async i=>{D.showAlert({title:"√ätes-vous s√ªr?",html:`Vous √™tes sur le point de supprimer la machine <b class="font-mono">${i.code} </b>. Cette action est <b class="text-pink-950">irr√©versible</b>`,confirmButtonText:"Oui, supprimer",onConfirm:async()=>{t.value||(t.value=await f());const r=await t.value.deleteMachine(i.id);return r instanceof c?(v.error("Error deleting machine:",r),h.error(`Erreur lors de la suppression de l'utilisateur: ${r.message}`),!1):(h.success(`Machine ${i.code} supprim√© avec succ√®s.`),n(),!0)}})};return C(async()=>{t.value=await f(),s.value=t.value.elements.map(i=>new o(i))}),{processing:e,machines:s,getMachines:n,findMachine:a,createMachine:k,updateMachine:R,updateMachineActivateOrDeactivate:A,deleteMachine:E}};export{o as M,f as a,de as u};
